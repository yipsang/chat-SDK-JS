!function(n){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=n();else if("function"==typeof define&&define.amd)define([],n);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.skygearChat=n()}}(function(){var n;return function n(e,t,r){function u(a,o){if(!t[a]){if(!e[a]){var c="function"==typeof require&&require;if(!o&&c)return c(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var f=t[a]={exports:{}};e[a][0].call(f.exports,function(n){var t=e[a][1][n];return u(t||n)},f,f.exports,n,e,t,r)}return t[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)u(r[a]);return u}({1:[function(n,e,t){(function(e){"use strict";function r(n){return n&&n.__esModule?n:{default:n}}function u(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.SkygearChatContainer=void 0;var i=function(){function n(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),a="undefined"!=typeof window?window.skygear:void 0!==e?e.skygear:null,o=r(a),c=n("underscore"),l=r(c),f=n("./pubsub"),s=r(f),d=o.default.Record.extend("conversation"),p=o.default.Record.extend("message"),v=o.default.Record.extend("receipt"),h=o.default.Record.extend("user_conversation"),y=t.SkygearChatContainer=function(){function n(){u(this,n)}return i(n,[{key:"createConversation",value:function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return o.default.lambda("chat:create_conversation",[n,e,t,r]).then(function(n){return new d(n.conversation)})}},{key:"createDirectConversation",value:function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return r.distinctByParticipants=!0,this.createConversation([n],e,t,r)}},{key:"getConversation",value:function(n){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return o.default.lambda("chat:get_conversation",[n,e]).then(function(n){if(null===n.conversation)throw new Error("no conversation found");return new d(n.conversation)})}},{key:"getConversations",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return o.default.lambda("chat:get_conversations",[n,e,t]).then(function(n){return n.conversations.map(function(n){return new d(n)})})}},{key:"_getUserConversation",value:function(n){var e=new o.default.Query(h);return e.equalTo("user",new o.default.Reference(o.default.auth.currentUser.id)),e.equalTo("conversation",new o.default.Reference(n.id)),o.default.publicDB.query(e).then(function(n){if(n.length>0)return n[0];throw new Error("no conversation found")})}},{key:"updateConversation",value:function(n,e,t){var r=new d;return r._id=n._id,e&&(r.title=e),t&&(r.meta=t),o.default.publicDB.save(r)}},{key:"leaveConversation",value:function(n){return o.default.lambda("chat:leave_conversation",[n._id]).then(function(){return!0})}},{key:"deleteConversation",value:function(n){return o.default.lambda("chat:delete_conversation",[n._id]).then(function(){return!0})}},{key:"addParticipants",value:function(n,e){var t=o.default.Record.parseID(n.id)[1],r=l.default.map(e,function(n){return n._id});return o.default.lambda("chat:add_participants",[t,r]).then(function(n){return new d(n.conversation)})}},{key:"removeParticipants",value:function(n,e){var t=o.default.Record.parseID(n.id)[1],r=l.default.map(e,function(n){return n._id});return o.default.lambda("chat:remove_participants",[t,r]).then(function(n){return new d(n.conversation)})}},{key:"addAdmins",value:function(n,e){var t=o.default.Record.parseID(n.id)[1],r=l.default.map(e,function(n){return n._id});return o.default.lambda("chat:add_admins",[t,r]).then(function(n){return new d(n.conversation)})}},{key:"removeAdmins",value:function(n,e){var t=o.default.Record.parseID(n.id)[1],r=l.default.map(e,function(n){return n._id});return o.default.lambda("chat:remove_admins",[t,r]).then(function(n){return new d(n.conversation)})}},{key:"createMessage",value:function(n,e,t,r){var u=new p;if(u.conversation=new o.default.Reference(n.id),u.body=e,u.metadata=void 0===t||null===t?{}:t,r)if(r instanceof o.default.Asset)u.attachment=r;else{var i=new o.default.Asset({file:r,name:r.name});u.attachment=i}return o.default.publicDB.save(u)}},{key:"editMessage",value:function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(e&&(n.body=e),t&&(n.metadata=t),r){var u=new o.default.Asset({file:r,name:r.name});n.attachment=u}return o.default.publicDB.save(n)}},{key:"deleteMessage",value:function(n){return o.default.lambda("chat:delete_message",[n._id]).then(function(n){return new p(n)})}},{key:"getUnreadCount",value:function(){return o.default.lambda("chat:total_unread")}},{key:"getMessages",value:function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=n._id,i={conversation_id:u,limit:e};return t&&(i.before_time=t),r&&(i.order=r),o.default.lambda("chat:get_messages",i).then(function(n){return n.results=n.results.map(function(n){return new p(n)}),this.markAsDelivered(n.results),n.results}.bind(this))}},{key:"getMessageReceipts",value:function(n){var e=n._id;return o.default.lambda("chat:get_receipt",[e]).then(function(n){return n.receipts=n.receipts.map(function(n){return new v(n)}),n.receipts})}},{key:"markAsDelivered",value:function(n){var e=l.default.map(n,function(n){return n._id});return o.default.lambda("chat:mark_as_delivered",[e])}},{key:"markAsRead",value:function(n){var e=l.default.map(n,function(n){return n._id});return o.default.lambda("chat:mark_as_read",[e])}},{key:"markAsLastMessageRead",value:function(n,e){return this._getUserConversation(n).then(function(t){return t.last_read_message=new o.default.Reference(e.id),o.default.publicDB.save(t),n.last_read_message_ref=t.last_read_message,n.last_read_message=e,n})}},{key:"getUnreadMessageCount",value:function(n){return n.unread_count}},{key:"sendTypingIndicator",value:function(n,e){this.pubsub.sendTyping(n,e)}},{key:"subscribeTypingIndicator",value:function(n,e){this.pubsub.subscribeTyping(n,e)}},{key:"subscribeAllTypingIndicator",value:function(n){this.pubsub.subscribeAllTyping(n)}},{key:"unsubscribeTypingIndicator",value:function(n,e){this.pubsub.unsubscribeTyping(n,e)}},{key:"subscribe",value:function(n){this.pubsub.subscribeMessage(n)}},{key:"unsubscribe",value:function(n){this.pubsub.unsubscribeMessage(n)}},{key:"pubsub",get:function(){return this._pubsub||(this._pubsub=new s.default(o.default)),this._pubsub}}]),n}(),g=new y;t.default=g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./pubsub":3,underscore:5}],2:[function(n,e,t){"use strict";var r=n("./container.js"),u=function(n){return n&&n.__esModule?n:{default:n}}(r),i=n("./utils.js"),a=function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e.default=n,e}(i);u.default.utils=a,e.exports=u.default},{"./container.js":1,"./utils.js":4}],3:[function(n,e,t){(function(e){"use strict";function r(n){return n&&n.__esModule?n:{default:n}}function u(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function n(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),a="undefined"!=typeof window?window.skygear:void 0!==e?e.skygear:null,o=r(a),c=n("uuid"),l=r(c),f=n("underscore"),s=r(f),d=o.default.Record.extend("user_channel"),p=function(){function n(e){u(this,n),this.pubsub=e.pubsub,this.userChannel=null,this.dispatch=this.dispatch.bind(this),this.getUserChannel().then(this.subscribeDispatch.bind(this)),this.typingHandler={},this.allTypingHandler=[],this.messageHandler=[]}return i(n,[{key:"subscribeDispatch",value:function(n){this.pubsub.on(n.name,this.dispatch)}},{key:"dispatch",value:function(n){"typing"===n.event?this.dispatchTyping(n.data):this.dispatchUpdate(n.data)}},{key:"dispatchUpdate",value:function(n){var e={record_type:n.record_type,event_type:n.event_type};e.record=new o.default.Record(n.record_type,n.record),n.original_record&&(e.original_record=new o.default.Record(n.record_type,n.original_record)),s.default.forEach(this.messageHandler,function(n){n(e)})}},{key:"dispatchTyping",value:function(n){s.default.forEach(this.allTypingHandler,function(e){e(n)}),s.default.forEach(n,function(n,e){var t=this.typingHandler[e];s.default.forEach(t,function(e){e(n)})}.bind(this))}},{key:"sendTyping",value:function(n,e){o.default.lambda("chat:typing",[n._id,e,new Date])}},{key:"subscribeAllTyping",value:function(n){this.allTypingHandler.push(n)}},{key:"subscribeTyping",value:function(n,e){this.typingHandler[n.id]||(this.typingHandler[n.id]=[]),this.typingHandler[n.id].push(e)}},{key:"unsubscribeTyping",value:function(n,e){var t=this.typingHandler[n.id];if(t){var r=t.indexOf(e);e&&-1!==r?t.splice(r,1):this.typingHandler[n.id]=[]}}},{key:"subscribeMessage",value:function(n){this.messageHandler.push(n)}},{key:"unsubscribeMessage",value:function(n){var e=this.messageHandler.indexOf(n);n&&-1!==e?this.messageHandler.splice(e,1):this.messageHandler=[]}},{key:"getUserChannel",value:function(){if(this.userChannel)return Promise.resolve(this.userChannel);var n=new o.default.Query(d);return o.default.privateDB.query(n).then(function(n){return n.length>0?(this.userChannel=n[0],this.userChannel):null}.bind(this)).then(function(n){if(null===n){var e=new d;return e.name=l.default.v4(),o.default.privateDB.save(e)}return this.userChannel=n,this.userChannel}.bind(this))}}]),n}();t.default=p}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{underscore:5,uuid:6}],4:[function(n,e,t){(function(e){"use strict";function r(n){return n&&n.__esModule?n:{default:n}}function u(n){function e(){a.default.sendTypingIndicator(n,"finished"),l=null}function t(){a.default.sendTypingIndicator(n,"begin"),l=setTimeout(e,o)}function r(){clearTimeout(l),l=setTimeout(e,o)}var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=u.debounceTime,o=void 0===i?3e3:i;if(!(n instanceof c.default.Record&&"conversation"===n.recordType))throw new Error("TypingDetector expects Conversation, instead got "+n+".");var l=null;return function(){l?r():t()}}Object.defineProperty(t,"__esModule",{value:!0}),t.createTypingDetector=u;var i=n("./container.js"),a=r(i),o="undefined"!=typeof window?window.skygear:void 0!==e?e.skygear:null,c=r(o)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./container.js":1}],5:[function(e,t,r){(function(){function e(n){function e(e,t,r,u,i,a){for(;i>=0&&i<a;i+=n){var o=u?u[i]:i;r=t(r,e[o],o,e)}return r}return function(t,r,u,i){r=k(r,i,4);var a=!C(t)&&w.keys(t),o=(a||t).length,c=n>0?0:o-1;return arguments.length<3&&(u=t[a?a[c]:c],c+=n),e(t,r,u,a,c,o)}}function u(n){return function(e,t,r){t=x(t,r);for(var u=M(e),i=n>0?0:u-1;i>=0&&i<u;i+=n)if(t(e[i],i,e))return i;return-1}}function i(n,e,t){return function(r,u,i){var a=0,o=M(r);if("number"==typeof i)n>0?a=i>=0?i:Math.max(i+o,a):o=i>=0?Math.min(i+1,o):i+o+1;else if(t&&i&&o)return i=t(r,u),r[i]===u?i:-1;if(u!==u)return i=e(p.call(r,a,o),w.isNaN),i>=0?i+a:-1;for(i=n>0?a:o-1;i>=0&&i<o;i+=n)if(r[i]===u)return i;return-1}}function a(n,e){var t=S.length,r=n.constructor,u=w.isFunction(r)&&r.prototype||f,i="constructor";for(w.has(n,i)&&!w.contains(e,i)&&e.push(i);t--;)(i=S[t])in n&&n[i]!==u[i]&&!w.contains(e,i)&&e.push(i)}var o=this,c=o._,l=Array.prototype,f=Object.prototype,s=Function.prototype,d=l.push,p=l.slice,v=f.toString,h=f.hasOwnProperty,y=Array.isArray,g=Object.keys,b=s.bind,m=Object.create,_=function(){},w=function(n){return n instanceof w?n:this instanceof w?void(this._wrapped=n):new w(n)};void 0!==r?(void 0!==t&&t.exports&&(r=t.exports=w),r._=w):o._=w,w.VERSION="1.8.3";var k=function(n,e,t){if(void 0===e)return n;switch(null==t?3:t){case 1:return function(t){return n.call(e,t)};case 2:return function(t,r){return n.call(e,t,r)};case 3:return function(t,r,u){return n.call(e,t,r,u)};case 4:return function(t,r,u,i){return n.call(e,t,r,u,i)}}return function(){return n.apply(e,arguments)}},x=function(n,e,t){return null==n?w.identity:w.isFunction(n)?k(n,e,t):w.isObject(n)?w.matcher(n):w.property(n)};w.iteratee=function(n,e){return x(n,e,1/0)};var j=function(n,e){return function(t){var r=arguments.length;if(r<2||null==t)return t;for(var u=1;u<r;u++)for(var i=arguments[u],a=n(i),o=a.length,c=0;c<o;c++){var l=a[c];e&&void 0!==t[l]||(t[l]=i[l])}return t}},T=function(n){if(!w.isObject(n))return{};if(m)return m(n);_.prototype=n;var e=new _;return _.prototype=null,e},A=function(n){return function(e){return null==e?void 0:e[n]}},O=Math.pow(2,53)-1,M=A("length"),C=function(n){var e=M(n);return"number"==typeof e&&e>=0&&e<=O};w.each=w.forEach=function(n,e,t){e=k(e,t);var r,u;if(C(n))for(r=0,u=n.length;r<u;r++)e(n[r],r,n);else{var i=w.keys(n);for(r=0,u=i.length;r<u;r++)e(n[i[r]],i[r],n)}return n},w.map=w.collect=function(n,e,t){e=x(e,t);for(var r=!C(n)&&w.keys(n),u=(r||n).length,i=Array(u),a=0;a<u;a++){var o=r?r[a]:a;i[a]=e(n[o],o,n)}return i},w.reduce=w.foldl=w.inject=e(1),w.reduceRight=w.foldr=e(-1),w.find=w.detect=function(n,e,t){var r;if(void 0!==(r=C(n)?w.findIndex(n,e,t):w.findKey(n,e,t))&&-1!==r)return n[r]},w.filter=w.select=function(n,e,t){var r=[];return e=x(e,t),w.each(n,function(n,t,u){e(n,t,u)&&r.push(n)}),r},w.reject=function(n,e,t){return w.filter(n,w.negate(x(e)),t)},w.every=w.all=function(n,e,t){e=x(e,t);for(var r=!C(n)&&w.keys(n),u=(r||n).length,i=0;i<u;i++){var a=r?r[i]:i;if(!e(n[a],a,n))return!1}return!0},w.some=w.any=function(n,e,t){e=x(e,t);for(var r=!C(n)&&w.keys(n),u=(r||n).length,i=0;i<u;i++){var a=r?r[i]:i;if(e(n[a],a,n))return!0}return!1},w.contains=w.includes=w.include=function(n,e,t,r){return C(n)||(n=w.values(n)),("number"!=typeof t||r)&&(t=0),w.indexOf(n,e,t)>=0},w.invoke=function(n,e){var t=p.call(arguments,2),r=w.isFunction(e);return w.map(n,function(n){var u=r?e:n[e];return null==u?u:u.apply(n,t)})},w.pluck=function(n,e){return w.map(n,w.property(e))},w.where=function(n,e){return w.filter(n,w.matcher(e))},w.findWhere=function(n,e){return w.find(n,w.matcher(e))},w.max=function(n,e,t){var r,u,i=-1/0,a=-1/0;if(null==e&&null!=n){n=C(n)?n:w.values(n);for(var o=0,c=n.length;o<c;o++)(r=n[o])>i&&(i=r)}else e=x(e,t),w.each(n,function(n,t,r){((u=e(n,t,r))>a||u===-1/0&&i===-1/0)&&(i=n,a=u)});return i},w.min=function(n,e,t){var r,u,i=1/0,a=1/0;if(null==e&&null!=n){n=C(n)?n:w.values(n);for(var o=0,c=n.length;o<c;o++)(r=n[o])<i&&(i=r)}else e=x(e,t),w.each(n,function(n,t,r){((u=e(n,t,r))<a||u===1/0&&i===1/0)&&(i=n,a=u)});return i},w.shuffle=function(n){for(var e,t=C(n)?n:w.values(n),r=t.length,u=Array(r),i=0;i<r;i++)e=w.random(0,i),e!==i&&(u[i]=u[e]),u[e]=t[i];return u},w.sample=function(n,e,t){return null==e||t?(C(n)||(n=w.values(n)),n[w.random(n.length-1)]):w.shuffle(n).slice(0,Math.max(0,e))},w.sortBy=function(n,e,t){return e=x(e,t),w.pluck(w.map(n,function(n,t,r){return{value:n,index:t,criteria:e(n,t,r)}}).sort(function(n,e){var t=n.criteria,r=e.criteria;if(t!==r){if(t>r||void 0===t)return 1;if(t<r||void 0===r)return-1}return n.index-e.index}),"value")};var R=function(n){return function(e,t,r){var u={};return t=x(t,r),w.each(e,function(r,i){var a=t(r,i,e);n(u,r,a)}),u}};w.groupBy=R(function(n,e,t){w.has(n,t)?n[t].push(e):n[t]=[e]}),w.indexBy=R(function(n,e,t){n[t]=e}),w.countBy=R(function(n,e,t){w.has(n,t)?n[t]++:n[t]=1}),w.toArray=function(n){return n?w.isArray(n)?p.call(n):C(n)?w.map(n,w.identity):w.values(n):[]},w.size=function(n){return null==n?0:C(n)?n.length:w.keys(n).length},w.partition=function(n,e,t){e=x(e,t);var r=[],u=[];return w.each(n,function(n,t,i){(e(n,t,i)?r:u).push(n)}),[r,u]},w.first=w.head=w.take=function(n,e,t){if(null!=n)return null==e||t?n[0]:w.initial(n,n.length-e)},w.initial=function(n,e,t){return p.call(n,0,Math.max(0,n.length-(null==e||t?1:e)))},w.last=function(n,e,t){if(null!=n)return null==e||t?n[n.length-1]:w.rest(n,Math.max(0,n.length-e))},w.rest=w.tail=w.drop=function(n,e,t){return p.call(n,null==e||t?1:e)},w.compact=function(n){return w.filter(n,w.identity)};var E=function(n,e,t,r){for(var u=[],i=0,a=r||0,o=M(n);a<o;a++){var c=n[a];if(C(c)&&(w.isArray(c)||w.isArguments(c))){e||(c=E(c,e,t));var l=0,f=c.length;for(u.length+=f;l<f;)u[i++]=c[l++]}else t||(u[i++]=c)}return u};w.flatten=function(n,e){return E(n,e,!1)},w.without=function(n){return w.difference(n,p.call(arguments,1))},w.uniq=w.unique=function(n,e,t,r){w.isBoolean(e)||(r=t,t=e,e=!1),null!=t&&(t=x(t,r));for(var u=[],i=[],a=0,o=M(n);a<o;a++){var c=n[a],l=t?t(c,a,n):c;e?(a&&i===l||u.push(c),i=l):t?w.contains(i,l)||(i.push(l),u.push(c)):w.contains(u,c)||u.push(c)}return u},w.union=function(){return w.uniq(E(arguments,!0,!0))},w.intersection=function(n){for(var e=[],t=arguments.length,r=0,u=M(n);r<u;r++){var i=n[r];if(!w.contains(e,i)){for(var a=1;a<t&&w.contains(arguments[a],i);a++);a===t&&e.push(i)}}return e},w.difference=function(n){var e=E(arguments,!0,!0,1);return w.filter(n,function(n){return!w.contains(e,n)})},w.zip=function(){return w.unzip(arguments)},w.unzip=function(n){for(var e=n&&w.max(n,M).length||0,t=Array(e),r=0;r<e;r++)t[r]=w.pluck(n,r);return t},w.object=function(n,e){for(var t={},r=0,u=M(n);r<u;r++)e?t[n[r]]=e[r]:t[n[r][0]]=n[r][1];return t},w.findIndex=u(1),w.findLastIndex=u(-1),w.sortedIndex=function(n,e,t,r){t=x(t,r,1);for(var u=t(e),i=0,a=M(n);i<a;){var o=Math.floor((i+a)/2);t(n[o])<u?i=o+1:a=o}return i},w.indexOf=i(1,w.findIndex,w.sortedIndex),w.lastIndexOf=i(-1,w.findLastIndex),w.range=function(n,e,t){null==e&&(e=n||0,n=0),t=t||1;for(var r=Math.max(Math.ceil((e-n)/t),0),u=Array(r),i=0;i<r;i++,n+=t)u[i]=n;return u};var D=function(n,e,t,r,u){if(!(r instanceof e))return n.apply(t,u);var i=T(n.prototype),a=n.apply(i,u);return w.isObject(a)?a:i};w.bind=function(n,e){if(b&&n.bind===b)return b.apply(n,p.call(arguments,1));if(!w.isFunction(n))throw new TypeError("Bind must be called on a function");var t=p.call(arguments,2),r=function(){return D(n,r,e,this,t.concat(p.call(arguments)))};return r},w.partial=function(n){var e=p.call(arguments,1),t=function(){for(var r=0,u=e.length,i=Array(u),a=0;a<u;a++)i[a]=e[a]===w?arguments[r++]:e[a];for(;r<arguments.length;)i.push(arguments[r++]);return D(n,t,this,this,i)};return t},w.bindAll=function(n){var e,t,r=arguments.length;if(r<=1)throw new Error("bindAll must be passed function names");for(e=1;e<r;e++)t=arguments[e],n[t]=w.bind(n[t],n);return n},w.memoize=function(n,e){var t=function(r){var u=t.cache,i=""+(e?e.apply(this,arguments):r);return w.has(u,i)||(u[i]=n.apply(this,arguments)),u[i]};return t.cache={},t},w.delay=function(n,e){var t=p.call(arguments,2);return setTimeout(function(){return n.apply(null,t)},e)},w.defer=w.partial(w.delay,w,1),w.throttle=function(n,e,t){var r,u,i,a=null,o=0;t||(t={});var c=function(){o=!1===t.leading?0:w.now(),a=null,i=n.apply(r,u),a||(r=u=null)};return function(){var l=w.now();o||!1!==t.leading||(o=l);var f=e-(l-o);return r=this,u=arguments,f<=0||f>e?(a&&(clearTimeout(a),a=null),o=l,i=n.apply(r,u),a||(r=u=null)):a||!1===t.trailing||(a=setTimeout(c,f)),i}},w.debounce=function(n,e,t){var r,u,i,a,o,c=function(){var l=w.now()-a;l<e&&l>=0?r=setTimeout(c,e-l):(r=null,t||(o=n.apply(i,u),r||(i=u=null)))};return function(){i=this,u=arguments,a=w.now();var l=t&&!r;return r||(r=setTimeout(c,e)),l&&(o=n.apply(i,u),i=u=null),o}},w.wrap=function(n,e){return w.partial(e,n)},w.negate=function(n){return function(){return!n.apply(this,arguments)}},w.compose=function(){var n=arguments,e=n.length-1;return function(){for(var t=e,r=n[e].apply(this,arguments);t--;)r=n[t].call(this,r);return r}},w.after=function(n,e){return function(){if(--n<1)return e.apply(this,arguments)}},w.before=function(n,e){var t;return function(){return--n>0&&(t=e.apply(this,arguments)),n<=1&&(e=null),t}},w.once=w.partial(w.before,2);var I=!{toString:null}.propertyIsEnumerable("toString"),S=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];w.keys=function(n){if(!w.isObject(n))return[];if(g)return g(n);var e=[];for(var t in n)w.has(n,t)&&e.push(t);return I&&a(n,e),e},w.allKeys=function(n){if(!w.isObject(n))return[];var e=[];for(var t in n)e.push(t);return I&&a(n,e),e},w.values=function(n){for(var e=w.keys(n),t=e.length,r=Array(t),u=0;u<t;u++)r[u]=n[e[u]];return r},w.mapObject=function(n,e,t){e=x(e,t);for(var r,u=w.keys(n),i=u.length,a={},o=0;o<i;o++)r=u[o],a[r]=e(n[r],r,n);return a},w.pairs=function(n){for(var e=w.keys(n),t=e.length,r=Array(t),u=0;u<t;u++)r[u]=[e[u],n[e[u]]];return r},w.invert=function(n){for(var e={},t=w.keys(n),r=0,u=t.length;r<u;r++)e[n[t[r]]]=t[r];return e},w.functions=w.methods=function(n){var e=[];for(var t in n)w.isFunction(n[t])&&e.push(t);return e.sort()},w.extend=j(w.allKeys),w.extendOwn=w.assign=j(w.keys),w.findKey=function(n,e,t){e=x(e,t);for(var r,u=w.keys(n),i=0,a=u.length;i<a;i++)if(r=u[i],e(n[r],r,n))return r},w.pick=function(n,e,t){var r,u,i={},a=n;if(null==a)return i;w.isFunction(e)?(u=w.allKeys(a),r=k(e,t)):(u=E(arguments,!1,!1,1),r=function(n,e,t){return e in t},a=Object(a));for(var o=0,c=u.length;o<c;o++){var l=u[o],f=a[l];r(f,l,a)&&(i[l]=f)}return i},w.omit=function(n,e,t){if(w.isFunction(e))e=w.negate(e);else{var r=w.map(E(arguments,!1,!1,1),String);e=function(n,e){return!w.contains(r,e)}}return w.pick(n,e,t)},w.defaults=j(w.allKeys,!0),w.create=function(n,e){var t=T(n);return e&&w.extendOwn(t,e),t},w.clone=function(n){return w.isObject(n)?w.isArray(n)?n.slice():w.extend({},n):n},w.tap=function(n,e){return e(n),n},w.isMatch=function(n,e){var t=w.keys(e),r=t.length;if(null==n)return!r;for(var u=Object(n),i=0;i<r;i++){var a=t[i];if(e[a]!==u[a]||!(a in u))return!1}return!0};var F=function(n,e,t,r){if(n===e)return 0!==n||1/n==1/e;if(null==n||null==e)return n===e;n instanceof w&&(n=n._wrapped),e instanceof w&&(e=e._wrapped);var u=v.call(n);if(u!==v.call(e))return!1;switch(u){case"[object RegExp]":case"[object String]":return""+n==""+e;case"[object Number]":return+n!=+n?+e!=+e:0==+n?1/+n==1/e:+n==+e;case"[object Date]":case"[object Boolean]":return+n==+e}var i="[object Array]"===u;if(!i){if("object"!=typeof n||"object"!=typeof e)return!1;var a=n.constructor,o=e.constructor;if(a!==o&&!(w.isFunction(a)&&a instanceof a&&w.isFunction(o)&&o instanceof o)&&"constructor"in n&&"constructor"in e)return!1}t=t||[],r=r||[];for(var c=t.length;c--;)if(t[c]===n)return r[c]===e;if(t.push(n),r.push(e),i){if((c=n.length)!==e.length)return!1;for(;c--;)if(!F(n[c],e[c],t,r))return!1}else{var l,f=w.keys(n);if(c=f.length,w.keys(e).length!==c)return!1;for(;c--;)if(l=f[c],!w.has(e,l)||!F(n[l],e[l],t,r))return!1}return t.pop(),r.pop(),!0};w.isEqual=function(n,e){return F(n,e)},w.isEmpty=function(n){return null==n||(C(n)&&(w.isArray(n)||w.isString(n)||w.isArguments(n))?0===n.length:0===w.keys(n).length)},w.isElement=function(n){return!(!n||1!==n.nodeType)},w.isArray=y||function(n){return"[object Array]"===v.call(n)},w.isObject=function(n){var e=typeof n;return"function"===e||"object"===e&&!!n},w.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(n){w["is"+n]=function(e){return v.call(e)==="[object "+n+"]"}}),w.isArguments(arguments)||(w.isArguments=function(n){return w.has(n,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(w.isFunction=function(n){return"function"==typeof n||!1}),w.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},w.isNaN=function(n){return w.isNumber(n)&&n!==+n},w.isBoolean=function(n){return!0===n||!1===n||"[object Boolean]"===v.call(n)},w.isNull=function(n){return null===n},w.isUndefined=function(n){return void 0===n},w.has=function(n,e){return null!=n&&h.call(n,e)},w.noConflict=function(){return o._=c,this},w.identity=function(n){return n},w.constant=function(n){return function(){return n}},w.noop=function(){},w.property=A,w.propertyOf=function(n){return null==n?function(){}:function(e){return n[e]}},w.matcher=w.matches=function(n){return n=w.extendOwn({},n),function(e){return w.isMatch(e,n)}},w.times=function(n,e,t){var r=Array(Math.max(0,n));e=k(e,t,1);for(var u=0;u<n;u++)r[u]=e(u);return r},w.random=function(n,e){return null==e&&(e=n,n=0),n+Math.floor(Math.random()*(e-n+1))},w.now=Date.now||function(){return(new Date).getTime()};var q={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},B=w.invert(q),U=function(n){var e=function(e){return n[e]},t="(?:"+w.keys(n).join("|")+")",r=RegExp(t),u=RegExp(t,"g");return function(n){return n=null==n?"":""+n,r.test(n)?n.replace(u,e):n}};w.escape=U(q),w.unescape=U(B),w.result=function(n,e,t){var r=null==n?void 0:n[e];return void 0===r&&(r=t),w.isFunction(r)?r.call(n):r};var H=0;w.uniqueId=function(n){var e=++H+"";return n?n+e:e},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var N=/(.)^/,P={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},K=/\\|'|\r|\n|\u2028|\u2029/g,z=function(n){return"\\"+P[n]};w.template=function(n,e,t){!e&&t&&(e=t),e=w.defaults({},e,w.templateSettings);var r=RegExp([(e.escape||N).source,(e.interpolate||N).source,(e.evaluate||N).source].join("|")+"|$","g"),u=0,i="__p+='";n.replace(r,function(e,t,r,a,o){return i+=n.slice(u,o).replace(K,z),u=o+e.length,t?i+="'+\n((__t=("+t+"))==null?'':_.escape(__t))+\n'":r?i+="'+\n((__t=("+r+"))==null?'':__t)+\n'":a&&(i+="';\n"+a+"\n__p+='"),e}),i+="';\n",e.variable||(i="with(obj||{}){\n"+i+"}\n"),i="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+i+"return __p;\n";try{var a=new Function(e.variable||"obj","_",i)}catch(n){throw n.source=i,n}var o=function(n){return a.call(this,n,w)};return o.source="function("+(e.variable||"obj")+"){\n"+i+"}",o},w.chain=function(n){var e=w(n);return e._chain=!0,e};var L=function(n,e){return n._chain?w(e).chain():e};w.mixin=function(n){w.each(w.functions(n),function(e){var t=w[e]=n[e];w.prototype[e]=function(){var n=[this._wrapped];return d.apply(n,arguments),L(this,t.apply(w,n))}})},w.mixin(w),w.each(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var e=l[n];w.prototype[n]=function(){var t=this._wrapped;return e.apply(t,arguments),"shift"!==n&&"splice"!==n||0!==t.length||delete t[0],L(this,t)}}),w.each(["concat","join","slice"],function(n){var e=l[n];w.prototype[n]=function(){return L(this,e.apply(this._wrapped,arguments))}}),w.prototype.value=function(){return this._wrapped},w.prototype.valueOf=w.prototype.toJSON=w.prototype.value,w.prototype.toString=function(){return""+this._wrapped},"function"==typeof n&&n.amd&&n("underscore",[],function(){return w})}).call(this)},{}],6:[function(n,e,t){var r=n("./v1"),u=n("./v4"),i=u;i.v1=r,i.v4=u,e.exports=i},{"./v1":9,"./v4":10}],7:[function(n,e,t){function r(n,e){var t=e||0,r=u;return r[n[t++]]+r[n[t++]]+r[n[t++]]+r[n[t++]]+"-"+r[n[t++]]+r[n[t++]]+"-"+r[n[t++]]+r[n[t++]]+"-"+r[n[t++]]+r[n[t++]]+"-"+r[n[t++]]+r[n[t++]]+r[n[t++]]+r[n[t++]]+r[n[t++]]+r[n[t++]]}for(var u=[],i=0;i<256;++i)u[i]=(i+256).toString(16).substr(1);e.exports=r},{}],8:[function(n,e,t){(function(n){var t,r=n.crypto||n.msCrypto;if(r&&r.getRandomValues){var u=new Uint8Array(16);t=function(){return r.getRandomValues(u),u}}if(!t){var i=new Array(16);t=function(){for(var n,e=0;e<16;e++)0==(3&e)&&(n=4294967296*Math.random()),i[e]=n>>>((3&e)<<3)&255;return i}}e.exports=t}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],9:[function(n,e,t){function r(n,e,t){var r=e&&t||0,u=e||[];n=n||{};var a=void 0!==n.clockseq?n.clockseq:c,s=void 0!==n.msecs?n.msecs:(new Date).getTime(),d=void 0!==n.nsecs?n.nsecs:f+1,p=s-l+(d-f)/1e4;if(p<0&&void 0===n.clockseq&&(a=a+1&16383),(p<0||s>l)&&void 0===n.nsecs&&(d=0),d>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");l=s,f=d,c=a,s+=122192928e5;var v=(1e4*(268435455&s)+d)%4294967296;u[r++]=v>>>24&255,u[r++]=v>>>16&255,u[r++]=v>>>8&255,u[r++]=255&v;var h=s/4294967296*1e4&268435455;u[r++]=h>>>8&255,u[r++]=255&h,u[r++]=h>>>24&15|16,u[r++]=h>>>16&255,u[r++]=a>>>8|128,u[r++]=255&a;for(var y=n.node||o,g=0;g<6;++g)u[r+g]=y[g];return e||i(u)}var u=n("./lib/rng"),i=n("./lib/bytesToUuid"),a=u(),o=[1|a[0],a[1],a[2],a[3],a[4],a[5]],c=16383&(a[6]<<8|a[7]),l=0,f=0;e.exports=r},{"./lib/bytesToUuid":7,"./lib/rng":8}],10:[function(n,e,t){function r(n,e,t){var r=e&&t||0;"string"==typeof n&&(e="binary"==n?new Array(16):null,n=null),n=n||{};var a=n.random||(n.rng||u)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,e)for(var o=0;o<16;++o)e[r+o]=a[o];return e||i(a)}var u=n("./lib/rng"),i=n("./lib/bytesToUuid");e.exports=r},{"./lib/bytesToUuid":7,"./lib/rng":8}]},{},[2])(2)});
//# sourceMappingURL=skygear-chat.min.js.map
